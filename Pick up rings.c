#pragma config(Sensor, port2,  distance,       sensorNone)
#pragma config(Sensor, port3,  horizontalGyro, sensorVexIQ_Gyro)
#pragma config(Sensor, port7,  Led,            sensorVexIQ_LED)
#pragma config(Sensor, port8,  ColorSensor,    sensorVexIQ_ColorGrayscale)
#pragma config(Sensor, port9,  LED2,           sensorVexIQ_LED)
#pragma config(Sensor, port12, BumpSense,      sensorVexIQ_Touch)
#pragma config(Motor,  motor1,          leftMotor,     tmotorVexIQ, PIDControl, driveLeft, encoder)
#pragma config(Motor,  motor4,          slideMotor,    tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor5,          armLift2,      tmotorVexIQ, PIDControl, encoder)
#pragma config(Motor,  motor6,          rightMotor,    tmotorVexIQ, PIDControl, reversed, driveRight, encoder)
#pragma config(Motor,  motor10,         armLift,       tmotorVexIQ, PIDControl, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

int  CalibrateGYROS(tSensors nGyro1,TI2CGyroCalibrateSamples nCalibrationSetting){
	/*
	Calibration of GYROS appears to be neccessary at the begining of any program
	where you are going to make use of a GYRO. The amount of time to complete the
	calibration process varys based on the number of samples specified.

	During calibration the robot mus be kept prefectly still.
	So we are going to wait a bit before starting calibration to
	insure know one is touching the robot.
	*/

	string str;

	displayString(1,"Calibrating Gyro....");
	sleep(2000);
	stringFormat(str, "Gyro1CaliFlag: %d", getGyroCalibrationFlag(nGyro1)); displayString(2, str);
	//stringFormat(str, "Gyro2CaliFlag: %d", getGyroCalibrationFlag(nGyro2)); displayString(3, str);

	/*This actually begins the gyro calibration process*/
	startGyroCalibration(nGyro1, nCalibrationSetting);
	//startGyroCalibration(nGyro2, nCalibrationSetting);

	sleep(10); //This appears to be need for debug but doesn't hurt anything.

	/*Loop until the calibration process is complete on both GYROS*/
	//while(getGyroCalibrationFlag(nGyro1)||getGyroCalibrationFlag(nGyro2))
	while(getGyroCalibrationFlag(nGyro1))
	{
		stringFormat(str, "Gyro1CaliFlag: %d", getGyroCalibrationFlag(nGyro1)); displayString(2, str);
		//	stringFormat(str, "Gyro2CaliFlag: %d", getGyroCalibrationFlag(nGyro2)); displayString(3, str);
		sleep(10);
	}
	/*###########################################
	*# GYRO Calibration is complete.
	*###########################################*/
	return 0;
}

bool RobotTasker()
{
	resetGyro(horizontalGyro);
	repeatUntil(getBumperValue(BumpSense)==true)
	{
		displaySensorValues(line3,horizontalGyro);

		if(getGyroDegrees(horizontalGyro)>0) //turning positive degrees WARNING DO NOT CHANGE TO FLOAT, KEEP AS IS!
		{
			setTouchLEDColor(Led,colorYellow);
			repeatUntil(getGyroDegreesFloat(horizontalGyro)>=-0.2 && getGyroDegreesFloat(horizontalGyro)<=0.2)
			{
				setTouchLEDColor(Led,colorYellow);
				setMotor(rightMotor,-60);
				setMotor(leftMotor,-45);
				if(getBumperValue(BumpSense)==true){break;}
			}
			displaySensorValues(line3,horizontalGyro);
		}//if end
		else if(getGyroDegrees(horizontalGyro)<0) //turning negative degrees WARNING DO NOT CHANGE TO FLOAT, KEEP AS IS!
		{
			setTouchLEDColor(Led,colorGreen);
			repeatUntil(getGyroDegreesFloat(horizontalGyro)>=-0.2 && getGyroDegreesFloat(horizontalGyro)<=0.2)
			{
				setTouchLEDColor(Led,colorGreen);
				setMotor(rightMotor,-60);
				setMotor(leftMotor,-75);
				if(getBumperValue(BumpSense)==true){break;}
			}
			displaySensorValues(line3,horizontalGyro);
		}//else if
		else //ahead full impulse
		{
			setMotor(leftMotor,-57);
			setMotor(rightMotor,-57);
			setTouchLEDColor(Led,colorViolet);
		}
		displaySensorValues(line3,horizontalGyro);

	}//repeatend
	stopAllMotors();
	setMotorBrakeMode(leftMotor,motorCoast);
	setMotorBrakeMode(rightMotor,motorCoast);
	setMotorBrakeMode(armLift,motorCoast);
	setMotorBrakeMode(armLift2,motorCoast);
	setMotorBrakeMode(slideMotor,motorCoast);

	return true;
}

task main()
{
	setTouchLEDColor(Led,colorRed);

	CalibrateGYROS(horizontalGyro,gyroCalibrateSamples4096);
	//	setGyroSensitivity(horizontalGyro,gyroHighSensitivity);

	setTouchLEDColor(Led,colorBlue);

	//If telling the gyro to turn negative degrees use the < symbol. Ex <=-100
	//If telling the gyro to turn positive degres use the > symbol. Ex >=100

	/*waitUntil(getTouchLEDValue(Led)==true);

	setTouchLEDColor(Led,colorViolet);

	setMotor(slideMotor,100);

	forward(6500, milliseconds,100);

	stopAllMotors();

	setMotor(slideMotor,-100);

	sleep(675);

	stopAllMotors();

	forward(950,milliseconds,50);

	sleep(500);

	backward(500,milliseconds,50);

	setMotor(slideMotor,-100);

	sleep(1400);

	stopAllMotors();

	forward(650,milliseconds,50);

	backward(700,milliseconds,100);

	setMotorBrakeMode(leftMotor,motorCoast);
	setMotorBrakeMode(rightMotor,motorCoast);
	setMotorBrakeMode(armLift2,motorCoast);
	setMotorBrakeMode(armLift,motorCoast);
	setMotorBrakeMode(slideMotor,motorCoast);

	waitUntil(getTouchLEDValue(Led)==true);

	setTouchLEDColor(Led,colorRed);

	setMotor(slideMotor,100);

	sleep(450);

	stopAllMotors();

	backward(1300,degrees,100);

	stopAllMotors();

	setMotorBrakeMode(armLift2,motorCoast);
	setMotorBrakeMode(armLift,motorCoast);
	setMotorBrakeMode(leftMotor,motorCoast);
	setMotorBrakeMode(rightMotor,motorCoast);
	setMotorBrakeMode(slideMotor,motorCoast);

	setTouchLEDColor(Led,colorRed);
*/
	waitUntil(getTouchLEDValue(Led)==true);

	setTouchLEDColor(Led,colorBlue);

	resetGyro(horizontalGyro);

	backward(1100,degrees,75); //Moving backward to blue rings.

	repeatUntil(getGyroDegrees(horizontalGyro)>=90) //Spinnig so clamps are pointed at Blue Peg.
	{
		setMotor(leftMotor,-50);

		setMotor(rightMotor,50);
	}



	stopAllMotors();

	setMotor(armLift2,-100);

	setMotor(armLift,100);

	backward(340,degrees,100); //Backing up into blue rings

	sleep(750);

	forward(400,milliseconds,25);

	stopAllMotors();

	setMotor(armLift,-100);

	setMotor(armLift2,100);

	sleep(1000);

	setMotorBrakeMode(armLift,motorHold);

	setMotorBrakeMode(armLift2,motorHold);

	forward(225,75); //Away from rings before spinning

	stopAllMotors();

	resetGyro(horizontalGyro);

	repeatUntil(getGyroDegrees(horizontalGyro)>=170) //Turning so that the ring clamps are facing the poles.
	{
		setMotor(leftMotor,-50);

		setMotor(rightMotor, 50);

	}

	stopAllMotors();
	displaySensorValues(line3,horizontalGyro);
	setMotor(armLift,-100); //Lifting the ARM up because it tends to lower down

	setMotor(armLift2,100);

	sleep(1200);

	setMotorBrakeMode(armLift,motorHold);

	setMotorBrakeMode(armLift2,motorHold);

	stopAllMotors();

	setMotor(slideMotor,-100); //sliding so that the ring clamp is on par with the pole.

	sleep(500);

	stopAllMotors();


	repeatUntil(getGyroDegrees(horizontalGyro)>=170) //Turning so that the ring clamps are facing the poles.
	{
		setMotor(leftMotor,-50);

		setMotor(rightMotor, 50);
	}
	stopAllMotors();
	sleep(20);

	RobotTasker(); //Backing up to put rings on pole.

	forward(50,degrees,100);

	sleep(20);

	stopAllMotors();

	setMotor(armLift,20);

	setMotor(armLift2,-20);

	sleep(1500);

	stopAllMotors();

	forward(360,degrees,100); //Pulling away so that the robot isn't touching the rings.

	setTouchLEDColor(Led,colorRed);
	repeat(forever);
	{
		sleep(100);
		setTouchLEDColor(Led,colorGreen);

		sleep(100);
		setTouchLEDColor(Led,colorBlue);

		sleep(100);
		setTouchLEDColor(Led,colorRed);
	}

}
